{% extends "base.html" %}

{% block title %}Dashboard {{ turma.nome }} - Associação Amigo do Povo{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="display-6 text-center mb-4">
            <i class="fas fa-users text-primary"></i>
            Dashboard - {{ turma.nome }}
        </h1>
        <div class="alert alert-info text-center">
            <div class="row">
                <div class="col-md-3">
                    <i class="fas fa-calendar-alt me-2"></i>
                    <strong>Horário:</strong> {{ turma.horario }}
                </div>
                <div class="col-md-3">
                    <i class="fas fa-calendar-week me-2"></i>
                    <strong>Dias:</strong> {{ turma.dias_semana }}
                </div>
                <div class="col-md-3">
                    <i class="fas fa-sun me-2"></i>
                    <strong>Período:</strong> {{ turma.periodo }}
                </div>
                <div class="col-md-3">
                    <i class="fas fa-users-cog me-2"></i>
                    <strong>Capacidade:</strong> {{ turma.total_alunos }}/{{ turma.capacidade_maxima }}
                </div>
            </div>
            {% if nivel_usuario == 'usuario' %}
                <br><small class="text-muted">Área do Professor - Dados específicos da sua turma</small>
            {% endif %}
        </div>
    </div>
</div>

<!-- Estatísticas da Turma -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card stat-card">
            <div class="card-body text-center">
                <i class="fas fa-users fa-2x mb-2"></i>
                <h3 class="card-title">{{ turma.total_alunos }}</h3>
                <p class="card-text">Alunos Matriculados</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card stat-card">
            <div class="card-body text-center">
                <i class="fas fa-percentage fa-2x mb-2"></i>
                <h3 class="card-title">
                    {% if turma.capacidade_maxima > 0 %}
                        {{ "%.0f" | format((turma.total_alunos / turma.capacidade_maxima) * 100) }}%
                    {% else %}
                        0%
                    {% endif %}
                </h3>
                <p class="card-text">Taxa de Ocupação</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card stat-card">
            <div class="card-body text-center">
                <i class="fas fa-calendar-check fa-2x mb-2"></i>
                <h3 class="card-title">{{ stats.presencas_hoje }}</h3>
                <p class="card-text">Presenças Hoje</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card stat-card">
            <div class="card-body text-center">
                <i class="fas fa-chart-line fa-2x mb-2"></i>
                <h3 class="card-title">{{ stats.presencas_semana }}</h3>
                <p class="card-text">Total Registros</p>
            </div>
        </div>
    </div>
</div>

<!-- Informações Detalhadas da Turma -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Detalhes da Turma
                </h5>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-4">Nome:</dt>
                    <dd class="col-sm-8">{{ turma.nome }}</dd>
                    
                    <dt class="col-sm-4">Atividade:</dt>
                    <dd class="col-sm-8">
                        <span class="badge bg-primary">{{ turma.atividade }}</span>
                    </dd>
                    
                    <dt class="col-sm-4">Horário:</dt>
                    <dd class="col-sm-8">
                        <i class="fas fa-clock text-primary me-1"></i>
                        {{ turma.horario }}
                    </dd>
                    
                    <dt class="col-sm-4">Dias:</dt>
                    <dd class="col-sm-8">{{ turma.dias_semana }}</dd>
                    
                    <dt class="col-sm-4">Período:</dt>
                    <dd class="col-sm-8">
                        {% if turma.periodo == 'Manhã' %}
                            <span class="badge bg-warning"><i class="fas fa-sun me-1"></i>{{ turma.periodo }}</span>
                        {% elif turma.periodo == 'Tarde' %}
                            <span class="badge bg-info"><i class="fas fa-cloud-sun me-1"></i>{{ turma.periodo }}</span>
                        {% else %}
                            <span class="badge bg-dark"><i class="fas fa-moon me-1"></i>{{ turma.periodo }}</span>
                        {% endif %}
                    </dd>
                    
                    <dt class="col-sm-4">Professor:</dt>
                    <dd class="col-sm-8">
                        {% if turma.professor_responsavel %}
                            <span class="badge bg-success">
                                <i class="fas fa-user-tie me-1"></i>
                                {{ turma.professor_responsavel }}
                            </span>
                        {% else %}
                            <span class="badge bg-warning">
                                <i class="fas fa-exclamation-triangle me-1"></i>
                                Não definido
                            </span>
                        {% endif %}
                    </dd>
                    
                    <dt class="col-sm-4">Status:</dt>
                    <dd class="col-sm-8">
                        {% if turma.ativa %}
                            <span class="badge bg-success">
                                <i class="fas fa-check-circle me-1"></i>Ativa
                            </span>
                        {% else %}
                            <span class="badge bg-danger">
                                <i class="fas fa-times-circle me-1"></i>Inativa
                            </span>
                        {% endif %}
                    </dd>
                    
                    <dt class="col-sm-4">Criada em:</dt>
                    <dd class="col-sm-8">{{ turma.data_criacao }}</dd>
                </dl>
            </div>
        </div>
    </div>
    
    <!-- Ações da Turma -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="fas fa-bolt me-2"></i>
                    Ações da Turma
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{{ url_for('presenca') }}" class="btn btn-primary">
                        <i class="fas fa-check-circle me-2"></i>
                        Marcar Presença
                    </a>
                    
                    <a href="{{ url_for('alunos') }}" class="btn btn-outline-primary">
                        <i class="fas fa-users me-2"></i>
                        Ver Alunos da Turma
                    </a>
                    
                    {% if nivel_usuario in ['admin', 'admin_master'] %}
                    <a href="{{ url_for('novo_aluno') }}" class="btn btn-success">
                        <i class="fas fa-user-plus me-2"></i>
                        Novo Aluno
                    </a>
                    
                    <a href="{{ url_for('gerenciar_turmas') }}" class="btn btn-warning">
                        <i class="fas fa-calendar-alt me-2"></i>
                        Gerenciar Turmas
                    </a>
                    {% endif %}
                    
                    <a href="{{ url_for('dashboard_atividade', nome_atividade=turma.atividade) }}" class="btn btn-outline-info">
                        <i class="fas fa-chart-pie me-2"></i>
                        Dashboard da Atividade
                    </a>
                    
                    <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>
                        Dashboard Geral
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Status da Turma -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-chart-bar me-2"></i>
                    Status e Estatísticas
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="text-center p-3 border rounded">
                            <h4 class="text-primary">{{ turma.total_alunos }}</h4>
                            <p class="mb-0">Alunos Matriculados</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center p-3 border rounded">
                            <h4 class="text-success">{{ turma.capacidade_maxima - turma.total_alunos }}</h4>
                            <p class="mb-0">Vagas Disponíveis</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center p-3 border rounded">
                            <h4 class="text-info">{{ turma.capacidade_maxima }}</h4>
                            <p class="mb-0">Capacidade Total</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Próximos Horários -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                    <i class="fas fa-calendar-day me-2"></i>
                    Próximos Horários da Turma
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <div class="row text-center">
                        <div class="col-md-4">
                            <i class="fas fa-clock fa-2x mb-2"></i>
                            <h5>{{ turma.horario }}</h5>
                            <p class="mb-0">Horário das Aulas</p>
                        </div>
                        <div class="col-md-4">
                            <i class="fas fa-calendar-week fa-2x mb-2"></i>
                            <h5>{{ turma.dias_semana }}</h5>
                            <p class="mb-0">Dias da Semana</p>
                        </div>
                        <div class="col-md-4">
                            {% set periodo_icon = 'sun' if turma.periodo == 'Manhã' else 'cloud-sun' if turma.periodo == 'Tarde' else 'moon' %}
                            <i class="fas fa-{{ periodo_icon }} fa-2x mb-2"></i>
                            <h5>{{ turma.periodo }}</h5>
                            <p class="mb-0">Período</p>
                        </div>
                    </div>
                </div>
                
                {% if turma.ativa %}
                    <div class="text-center">
                        <p class="text-success mb-2">
                            <i class="fas fa-check-circle me-1"></i>
                            <strong>Turma Ativa</strong> - Aulas acontecem normalmente
                        </p>
                        <p class="text-muted small">
                            Próxima aula conforme horário regular da turma
                        </p>
                    </div>
                {% else %}
                    <div class="alert alert-warning text-center">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Turma Inativa</strong> - Não há aulas agendadas no momento
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Dicas Específicas da Turma -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0">
                    <i class="fas fa-lightbulb me-2"></i>
                    Dicas para Gestão da Turma
                </h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li class="mb-2">
                        <i class="fas fa-arrow-right text-primary me-2"></i>
                        <small>Use "Marcar Presença" nos horários específicos da turma</small>
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-arrow-right text-primary me-2"></i>
                        <small>Monitore a capacidade da turma para evitar superlotação</small>
                    </li>
                    {% if nivel_usuario == 'usuario' %}
                    <li class="mb-2">
                        <i class="fas fa-arrow-right text-warning me-2"></i>
                        <small>Você é responsável apenas por esta turma específica</small>
                    </li>
                    {% endif %}
                    <li class="mb-0">
                        <i class="fas fa-save text-success me-2"></i>
                        <small>Dados de presença são salvos automaticamente</small>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
